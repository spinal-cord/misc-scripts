#!/bin/bash

FILE_PATH="$1"
CHECKSUM_FILE="$2"

# Check if files exist
if [[ ! -f "$FILE_PATH" ]]; then
    echo "Error: File not found: $FILE_PATH"
    exit 1
fi

if [[ ! -f "$CHECKSUM_FILE" ]]; then
    echo "Error: Checksum file not found: $CHECKSUM_FILE"
    exit 1
fi

# Calculate current hash
CURRENT_HASH=$(sha256sum "$FILE_PATH" | awk '{print $1}')

# Read expected hash from checksum file
EXPECTED_HASH=$(awk '{print $1}' "$CHECKSUM_FILE")
EXPECTED_FILENAME=$(awk '{print $3}' "$CHECKSUM_FILE")

# Verify
echo "Expected hash:   $EXPECTED_HASH"
echo "Calculated hash: $CURRENT_HASH"

if [[ "$CURRENT_HASH" == "$EXPECTED_HASH" ]]
then
    echo "SUCCESS: File integrity verified!"
    echo "   File has not been tampered with or corrupted."
    exit 0
else
    echo "FAILURE: Hash mismatch!"
    echo "   The file may be corrupted or tampered with."
    echo "   DO NOT USE THIS FILE."
    exit 1
fi